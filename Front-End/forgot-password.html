<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mot de passe oubliÃ© - TalibHub</title>
    <link rel="stylesheet" href="password-styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="password-container">
      <div class="password-card">
        <div class="password-header">
          <h1>TalibHub<span>(Beta)</span></h1>
          <div class="language-selector">
            <button class="lang-btn" data-lang="fr" title="FranÃ§ais">ðŸ‡«ðŸ‡·</button>
            <button class="lang-btn" data-lang="en" title="English">ðŸ‡¬ðŸ‡§</button>
          </div>
        </div>
        <div class="password-content">
          <h2 data-lang-key="title">Mot de passe oubliÃ©</h2>
          <p data-lang-key="instruction">
            Veuillez entrer votre adresse e-mail pour recevoir un lien de
            rÃ©initialisation de mot de passe.
          </p>

          <form id="forgotPasswordForm" class="password-form">
            <div class="form-group">
              <label for="email" data-lang-key="email_label"
                >Adresse e-mail</label
              >
              <input type="email" id="email" name="email" required />
            </div>

            <div class="form-actions">
              <button
                type="submit"
                class="btn-primary"
                data-lang-key="submit_btn"
              >
                Envoyer le lien
              </button>
              <a
                href="index.html"
                class="btn-link"
                id="backToLogin"
                data-lang-key="back_link"
                >Retour Ã  la connexion</a
              >
            </div>
          </form>

          <div id="message" class="message"></div>
        </div>
      </div>
    </div>

    <script>
      // Traductions
      const translations = {
        fr: {
          title: "Mot de passe oubliÃ©",
          instruction:
            "Veuillez entrer votre adresse e-mail pour recevoir un lien de rÃ©initialisation de mot de passe.",
          email_label: "Adresse e-mail",
          submit_btn: "Envoyer le lien",
          back_link: "Retour Ã  la connexion",
          sending: "Envoi en cours...",
          success:
            "Un lien de rÃ©initialisation a Ã©tÃ© envoyÃ© Ã  votre adresse e-mail.",
          error: "Une erreur est survenue.",
          form_error: "Erreur lors de l'envoi du formulaire.",
        },
        en: {
          title: "Forgot Password",
          instruction:
            "Please enter your email address to receive a password reset link.",
          email_label: "Email address",
          submit_btn: "Send Link",
          back_link: "Back to login",
          sending: "Sending...",
          success: "A reset link has been sent to your email address.",
          error: "An error occurred.",
          form_error: "Error submitting form.",
        },
      };

      // Initialiser la langue
      function initLanguage() {
        // RÃ©cupÃ©rer la langue sauvegardÃ©e ou utiliser la langue du navigateur
        const savedLang = localStorage.getItem("userLang");
        const browserLang = navigator.language || navigator.userLanguage;
        const currentLang =
          savedLang || (browserLang.startsWith("fr") ? "fr" : "en");

        // Sauvegarder la langue si elle n'existe pas dÃ©jÃ 
        if (!savedLang) {
          localStorage.setItem("userLang", currentLang);
        }

        // Appliquer les traductions
        applyTranslations(currentLang);

        // Mettre Ã  jour l'URL du lien de retour
        updateBackLink(currentLang);
      }

      // Appliquer les traductions selon la langue choisie
      function applyTranslations(lang) {
        const elements = document.querySelectorAll("[data-lang-key]");
        elements.forEach((element) => {
          const key = element.getAttribute("data-lang-key");
          if (translations[lang] && translations[lang][key]) {
            if (element.tagName === "INPUT") {
              element.placeholder = translations[lang][key];
            } else {
              element.textContent = translations[lang][key];
            }
          }
        });

        // Mettre Ã  jour la langue du document
        document.documentElement.lang = lang;
      }

      // Mettre Ã  jour le lien de retour selon la langue
      function updateBackLink(lang) {
        const backLink = document.getElementById("backToLogin");
        if (backLink) {
          backLink.href = `index-${lang}.html`;
        }
      }

      // GÃ©rer les boutons de langue
      document.querySelectorAll(".lang-btn").forEach((button) => {
        button.addEventListener("click", function () {
          const lang = this.getAttribute("data-lang");
          localStorage.setItem("userLang", lang);
          applyTranslations(lang);
          updateBackLink(lang);
        });
      });

      // GÃ©rer la soumission du formulaire
      document
        .getElementById("forgotPasswordForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const email = this.email.value;
          const messageEl = document.getElementById("message");
          const currentLang = localStorage.getItem("userLang") || "fr";

          try {
            messageEl.className = "message info";
            messageEl.textContent = translations[currentLang].sending;

            const response = await fetch("/api/auth/forgot-password", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email }),
            });

            const data = await response.json();

            if (response.ok) {
              messageEl.className = "message success";
              messageEl.textContent =
                data.message || translations[currentLang].success;
            } else {
              messageEl.className = "message error";
              messageEl.textContent =
                data.error || translations[currentLang].error;
            }
          } catch (err) {
            messageEl.className = "message error";
            messageEl.textContent = translations[currentLang].form_error;
            console.error(err);
          }
        });

      // Initialiser la langue au chargement de la page
      document.addEventListener("DOMContentLoaded", initLanguage);
    </script>
  </body>
</html>
